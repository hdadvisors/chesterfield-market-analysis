# Rental market summary 

This section summarizes the existing stock of rental units within the county and provides an analysis of recent price and production trends in the rental market.

```{r setup}

library(tidyverse)
library(tidycensus)
library(glue)
library(esquisse)
library(plotly)
library(scales)
library(formattable)
library(simplevis)
library(lubridate)
library(patchwork)
library(knitr)
library(zoo)
library(janitor)

```
## Rental housing stock

The proliferation of rental housing throughout Chesterfield County has been the result of affordability challenges across the region, as well as an increasing preference for [young professionals and baby boomers] (https://www.freddiemac.com/research/consumer-research/20180404-preference-for-renting)


### Total renters
Over the past decade, the number of renter households in the county has steadily been increasing. From 2010 to 2019, the number of renters in the county has gone from 24,312 to 30,273 --- a 24 percent increase. 

In 2020, there was a two percent decrease in renters. But this decrease of 633 renters can be attributed to the pitfalls of the 2020 Census count.

```{r tenure}

years <- 2010:2020

b25003_vars <- load_variables(2010, "acs5") |> 
  filter(str_sub(name, end = 7) %in% "B25003_")

b25003_raw <- map_dfr(years, function(yr){
  b25003_pull <- get_acs(
    geography = "county",
    county = "Chesterfield County",
    state = "VA",
    table = "B25003",
    year = yr,
    survey = "acs5",
    cache_table = TRUE
  ) %>%
    mutate(year = yr)
  })

b25003_vars_cleaned <- b25003_vars |> 
  separate(label, into = c("est", "total", "tenure"), sep = "!!") |> 
  select(variable = name, tenure) |> 
  drop_na() |> 
  mutate(tenure = case_when(
    tenure == "Owner occupied" ~ "Homeowner",
    tenure == "Renter occupied" ~ "Renter"
  )) |> 
  filter(tenure == "Renter")

b25003_data <- b25003_raw |> 
  right_join(b25003_vars_cleaned, by = "variable") |> 
  select(NAME, fips = GEOID, year, tenure, estimate, moe)
  

renters_plot <- gg_line(
  b25003_data,
  x_var = year,
  y_var = estimate,
  y_breaks_n = 5,
  title = "Renter households",
  x_title = element_blank())

plotly::ggplotly(renters_plot) %>% 
  plotly_camera()

```

### Housing type

Single-family home rentals (SFR) in the county have been on the rise. In 2010, 8,482 single-family detached homes were being used as rentals. By 2020, that number had increased to 10,894 --- just over a third of all rental housing in the county. This equates to a 28 percent increase.

```{r structure}

years <- 2010:2020

b25032_vars <- load_variables(2010, "acs5") |> 
  filter(str_sub(name, end = 7) %in% "B25032_")

b25032_raw <- map_dfr(years, function(yr){
  b25032_pull <- get_acs(
    geography = "county",
    county = "Chesterfield County",
    state = "VA",
    table = "B25032",
    year = yr,
    survey = "acs5",
    cache_table = TRUE
  ) %>%
    mutate(year = yr)
  })

b25032_vars_cleaned <- b25032_vars |> 
  separate(label, into = c("est", "total", "tenure", "structure"), sep = "!!") |> 
  select(variable = name, tenure, structure) |> 
  drop_na() |> 
  filter(tenure == "Renter-occupied housing units")

b25032_data <- b25032_raw |> 
  right_join(b25032_vars_cleaned, by = "variable") |> 
  select(NAME, fips = GEOID, year, structure, estimate, moe)

structure_plot <- gg_bar_col(
  b25032_data,
  stack = TRUE,
  x_var = year,
  y_var = estimate,
  col_var = structure,
  y_breaks_n = 5,
  title = "Rental housing by structure type",
  x_title = element_blank()) +
    theme(
      legend.position = "none"
    )

plotly::ggplotly(structure_plot) %>% 
  plotly_camera()


```

SFRs are a growing trend in the rental market as lifestyle changes and affordability challenges. The COVID-19 pandemic has also had a dramatic impact on the demand for SFRs, as many individuals and families looked avoid higher density apartments and had the ability to work and learn remotely.

(https://www.nmhc.org/research-insight/research-notes/2021/an-overview-of-single-family-rentals/)

```{r sfr}

```


While single-family homes saw a major increase in rentals, manufactured homes experienced a significant decrease. From 791 in 2010 to 527 in 2020, the reported number of manufactured homes in the county has been cut down by a third.

```
CALL OUT BOX ON MANUFACTURED HOUSING COMMUNITIES

Manufactured home communities are a valuable source of affordable housing across Virginia. Chesterfield County is home to a significant amount of MHCs --- x in total. However, a significant issue faces manufactured home community residents. MHCs often give residents two options, 1) a resident may rent both their home and the lot on which that home is placed, or 2) a resident may own their home and rent the lot on which that home is placed.

In both cases, a resident is renting, but those residents in the second case are in an especially precarious situation should a MHC owner choose to sell or redevelop their property. 
```

Most rental housing in the county are two-bedroom and three-bedroom homes. This accounts for nearly half of all rental housing in the county (68 percent). 

The number of four-bedroom rental homes has been on a steady increase since 2010 --- from 1,995 to 3,453 in 2020, a 73 percent increase. Although the increasing number of families in search of larger homes has led to a corresponding demand in larger rental homes, the impact can be felt among single adults, especially low-income adults, needing affordable rental opportunities. 

```{r bedrooms}

years <- 2010:2020

b25042_vars <- load_variables(2010, "acs5") |> 
  filter(str_sub(name, end = 6) %in% "B25042")

b25042_raw <- map_dfr(years, function(yr){
  b25042_pull <- get_acs(
    geography = "county",
    county = "Chesterfield County",
    state = "VA",
    table = "B25042",
    year = yr,
    survey = "acs5",
    cache_table = TRUE
  ) %>%
    mutate(year = yr)
  })

b25042_vars_cleaned <- b25042_vars |> 
  separate(label, into = c("est", "total", "tenure", "bedrooms"), sep = "!!") |> 
  select(variable = name, tenure, bedrooms) |> 
  drop_na() |> 
  filter(tenure == "Renter occupied")

b25042_data <- b25042_raw |> 
  right_join(b25042_vars_cleaned, by = "variable") |> 
  select(NAME, fips = GEOID, year, bedrooms, estimate, moe)

bedroom_plot <- gg_bar_col_facet(
  b25042_data,
  stack = TRUE,
  x_var = year,
  y_var = estimate,
  col_var = bedrooms,
  facet_var = bedrooms,
  y_breaks_n = 5,
  title = "Rental housing by bedrooms",
  x_title = element_blank()) +
    theme(
      legend.position = "none"
    )

plotly::ggplotly(bedroom_plot) %>% 
  plotly_camera()

```

The majority of existing rental housing (11,229 rental homes) in the county was built between 1960 and 1999. This represents a significant portion of rental housing that is at least 20 years of age. Aging rental homes often mean increasing maintenance costs or the need for significant renovations that get passed down to tenants. 

```{r yearbuilt}

b25036_vars <- load_variables(2020, "acs5") |> 
  filter(str_sub(name, end = 6) %in% "B25036")

b25036_raw <- get_acs(
    geography = "county",
    county = "Chesterfield County",
    state = "VA",
    table = "B25036",
    year = 2020,
    survey = "acs5",
    cache_table = TRUE
  )

b25036_vars_cleaned <- b25036_vars |> 
  separate(label, into = c("est", "total", "tenure", "yrbuilt"), sep = "!!") |> 
  select(variable = name, tenure, yrbuilt)

b25036_data <- b25036_raw |> 
  right_join(b25036_vars_cleaned, by = "variable") |> 
  select(NAME, fips = GEOID, yrbuilt, tenure, estimate, moe) |> 
  drop_na() |> 
  filter(tenure == "Renter occupied:") |> 
  mutate(yrbuilt = case_when(
    yrbuilt == "Built 2014 or later" ~ "2010 or later",
    yrbuilt == "Built 2010 to 2013" ~ "2010 or later",
    yrbuilt == "Built 2000 to 2009" ~ "2000 to 2009",
    yrbuilt == "Built 1990 to 1999" ~ "1980 to 1999",
    yrbuilt == "Built 1980 to 1989" ~ "1980 to 1999",
    yrbuilt == "Built 1970 to 1979" ~ "1960 to 1979",
    yrbuilt == "Built 1960 to 1969" ~ "1960 to 1979",
    yrbuilt == "Built 1950 to 1959" ~ "1940 to 1959",
    yrbuilt == "Built 1940 to 1949" ~ "1940 to 1959",
    yrbuilt == "Built 1939 or earlier" ~ "1939 or earlier"
  ))

built_plot <- gg_bar(
  b25036_data,
  x_var = yrbuilt,
  y_var = estimate,
  y_breaks_n = 5,
  title = "Rental housing by year built",
  x_title = element_blank()) +
    theme(
      legend.position = "none"
    )

plotly::ggplotly(built_plot) %>% 
  plotly_camera()

```




CoStar does not collect data on single-family rentals, therefore it is difficult to understand the single-family rental, or SFR, market in the county. 

Across CoStar's multifamily database, however, there are 118 existing rental properties. This excludes nine manufactured home parks identified by the Manufactured Housing Community Coalition of Virginia in their 2016 Central Virginia study.

There are at least 23,377 homes across these 127 properties.


```{r costar-buildings}

existing <- read_csv("data/costar_existing.csv")

```

## Rental housing costs

From the early 2000s, rental housing costs had generally been declining in the county. But changing trends in affordability and lifestyle have led to an increasing demand for rentals that has led to a complementary increase in rental housing costs. Since 2012, the average asking rent in the county has been on a steady increase. In Q3 2021, average asking rent in the county reached a two decade high of $1,510. 
```{r costar-rents}

# This is pulling in average rents for all existing multifamily properties in the county. For some reason, this differs from the previous average rent calculations for some reason. I'd resolve this by updating the previous visualization in Part-1B-4.


rent <- read_csv("data/costar_rent_existing_may_12.csv") |>
  pivot_longer(cols = 2:3, names_to = "type", values_to = "value") |> 
  mutate(period = as.Date(as.yearqtr(period, format = "%Y Q%q"), frac = 1)) |> 
  mutate(type = str_replace_all(type, c("rent" = "Asking rent",
                                        "rent_adj" = "rent (inflation-adjusted)")))


costar_rent <-gg_line_col(
  rent,
  x_var = period,
  y_var = value,
  col_var = type,
  alpha_point = 0,
  size_line = 0.75,
  title = "Average asking rent in Chesterfield County",
  y_labels = label_dollar(),
  y_title = "Average asking rent",
  x_title = element_blank(),
  y_zero = TRUE,
  x_labels = scales::date_format(format = "%Y")
  ) +
  ggplot2::scale_x_date(limits = as.Date(c(NA, Sys.Date()))) +
  ggplot2::theme(
    legend.title = element_blank(),
    legend.position = "top",
    legend.direction = "horizontal",
    legend.justification = "center"
  )

plotly::ggplotly(costar_rent) %>% 
  plotly_camera()



```

The number of bedrooms often impacts rental housing costs --- simply put, more bedrooms equals higher rent. But in Chesterfield County, studio apartments command a higher average asking rent than housing with more bedrooms. In Q1 2022, the average asking rent for a studio apartment was \$2,300, roughly \$600 more than a three-bedroom apartment. 

```
I question using the studio rent. I think the sample is probably flawed here. But may be an important thing to highlight

```

```{r bedroom-rents}

bedroom_rent <- read_csv("data/costar_br_existing_may_12.csv") |>
  pivot_longer(cols = 2:9, names_to = "type", values_to = "value") |>
  mutate(period = as.Date(as.yearqtr(period, format = "%Y Q%q"), frac = 1)) |> 
  mutate(rent = sub(".*_", "", type)) |> 
  mutate(rent = str_replace_all(rent, c("rent" = "Asking rent",
                                        "adj" = "rent (inflation-adjusted)")))
bedroom_rent <- bedroom_rent |> 
  filter(rent != "Asking rent") |> 
  mutate(type = substr(type,1,1))

costar_br_rent <-gg_line_col(
  bedroom_rent,
  x_var = period,
  y_var = value,
  col_var = type,
  alpha_point = 0,
  size_line = 0.75,
  title = "Average asking rent in Chesterfield County by bedroom",
  y_labels = label_dollar(),
  y_title = "Average asking rent",
  x_title = element_blank(),
  y_zero = TRUE,
  x_labels = scales::date_format(format = "%Y")
  ) +
  ggplot2::scale_x_date(limits = as.Date(c(NA, Sys.Date()))) +
  ggplot2::theme(
    legend.title = element_blank(),
    legend.position = "top",
    legend.direction = "horizontal",
    legend.justification = "center"
  )

plotly::ggplotly(costar_br_rent) %>% 
  plotly_camera()

```

## Rental housing construction

Like most of the country, the Great Recession negatively impacted home building in the county --- both in terms of single-family and multifamily housing. That impact was most felt among single-family home construction, however. Pre-recession, the average single-family residential construction permits numbered 2,050 and post-recession single-family home starts have been slow to recover to that pre-recession era. It was not until 2020 that the county exceeded that pre-recession average. 

Multifamily (five or more units) home starts were not as impacted by the recession due to the generally low number of multifamily construction permits. Multifamily building permits saw a substantial increase in 2019 when it reached a two decade high of 1,466. 

Duplexes and smaller multifamily homes like tri-plexes and quads have not seen substantial construction in the county. These types of properties often make up what is called "[Missing Middle](https://missingmiddlehousing.com/)" housing, a term used to describe smaller multifamily and clustered single-family housing that often offers affordability by design (i.e. smaller homes typically mean lower price).

```{r permits}

years <- 2000:2020

header_rows <- read_csv("https://www2.census.gov/econ/bps/County/co2020a.txt", 
                        col_names = FALSE,
                        n_max = 2)

column_names <- header_rows %>%
  select(X1:X18) %>%
  t() %>%
  as_tibble() %>%
  mutate(group = rep(1:6, each = 3)) %>%
  group_by(group) %>%
  fill(V1, .direction = "updown") %>%
  mutate(names = paste0(V1, ": ", V2)) %>%
  pull(names)

cbps_raw <- map_df(years, ~{
  raw <- read_csv(glue("https://www2.census.gov/econ/bps/County/co{.x}a.txt"), skip = 2, 
                    col_names = FALSE) %>%
    select(X1:X18) %>%
    set_names(column_names)
  
  raw
  
})

cbps_data <- cbps_raw %>% 
  mutate(year = `Survey: Date`,
         GEOID = paste0(`FIPS: State`, `FIPS: County`)) %>%
  select(`1-unit: Bldgs`:GEOID) %>%
  filter(GEOID == "51041") %>%
  pivot_longer(`1-unit: Bldgs`:`5+ units: Value`,
               names_to = "type",
               values_to = "value") %>%
  separate(type, into = c("Type", "col"), sep = ": ") %>%
  pivot_wider(names_from = col,
              values_from = value) %>%
  rename_with(tolower, Type:Value) %>% 
  select(GEOID, year, type:units)

permits <- gg_bar_col_facet(
  cbps_data,
  x_var = year,
  y_var = units,
  col_var = type,
  facet_var = type)

plotly::ggplotly(permits) |>  
  plotly_camera()

```

There are currently 19 proposed or under construction multifamily developments in the county --- an estimated total of 5,039 rental homes^[Three properties do not have number of units listed and are slated for a 2027 completion date]. Six of these properties are expected to be completed in 2022, while the remaining homes will be completed over the next two years.

```{r costar-construction}

under_con <- read_csv("data/costar_under_con_may_13.csv") |> 
  clean_names()

sum(under_con$number_of_units, na.rm = TRUE)


```

