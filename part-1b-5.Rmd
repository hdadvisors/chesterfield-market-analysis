# Route 1 affordability analysis  {#part-1b-5}

Census tracts 1003, 1004.03, 1004.04, 1004.05, 1004.06, 1004.07, 1004.09 covers 
from Northern Chesterfield to Route 10.

[reserved]

```{r global, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, 
                      message=FALSE, 
                      warning=FALSE, 
                      include=FALSE)

```


```{r route1, message=FALSE, warning=FALSE}
library(tidyverse)
library(tidycensus)
library(readxl)

years <- 2010:2019

b25119_vars <- load_variables(2010, "acs5") %>%
  filter(str_sub(name, end = 6) %in% "B25119")

b25119_raw <- map_dfr(years, function(yr){
  b25119_pull <- get_acs(
    geography = "tract",
    county = "Chesterfield County",
    state = "VA",
    table = "B25119",
    year = yr,
    survey = "acs5"
  ) %>%
    mutate(year = yr)
  })

b25119_vars_cleaned <- b25119_vars %>%
  separate(label, into = c("est", "income", "tenure"), sep = "!!") %>% 
  select(variable = name, tenure) %>%
  mutate(tenure = case_when(
    tenure == "Total" ~ "All households",
    tenure == "Owner occupied (dollars)" ~ "Homeowner",
    tenure == "Renter occupied (dollars)" ~ "Renter"
  ))

b25119_data <- b25119_raw %>%
  right_join(b25119_vars_cleaned, by = "variable") %>%
  select(NAME, year, tenure, estimate, moe) %>%
  group_by(year, NAME, tenure) %>%
  summarise(
    estimate = sum(estimate),
    moe = moe_sum(moe, estimate)
  ) %>% 
  ungroup() %>% 
  mutate(cv = ((moe/1.645)/estimate)*100) %>% 
  mutate(reliability = case_when(
    cv < 15 ~ "High reliability",
    cv >= 15 & cv <= 30 ~ "Medium reliability",
    cv > 30 ~ "Low reliability")
  )

cpi <- read_excel("data/CPI_U_RS.xlsx")
cpi <- cpi %>% 
  rename(year = Year,
         priceindex = Index) %>%
  transform(year = as.numeric(year))

route1 <- c("Census Tract 1003", "Census Tract 1004.03", "Census Tract 1004.04", "Census Tract 1004.05",
         "Census Tract 1004.06", "Census Tract 1004.07","Census Tract 1004.09")

b25119_cpi <- b25119_data %>%
    left_join(cpi, by = 'year') %>%
  transform(dollars19 = ((376.5/priceindex)*estimate)) %>%
  select(year, NAME, tenure, dollars19, moe, reliability) %>%
  separate(NAME, into = c("tract", "county", "state"), sep = ",") %>%
  select(year, tract, tenure, dollars19, moe, reliability)

route1_tracts <- b25119_cpi %>%
  subset(tract %in% route1)



# Reserved for Shiny app
```

```