# (PART) CORRIDOR CASE STUDIES {.unnumbered}

# Route 1 corridor analysis {#part-2b-1}

This section describes the Route 1 corridor in terms of its rental housing market, proximity of rental homes to amenities, recent major investments, and homeownership relative to the price of single-family rentals.

The Route 1 corridor used in this section uses the same six census tracts from the previous Route 1 affordability analysis in [Chapter 10](#part-1b-5).

```{r setup}

library(tidycensus)
library(tidyverse)
library(janitor)
library(leaflet)
library(sf)
library(sp)
library(tigris)
library(mapview)
library(simplevis)
library(readxl)
library(ggplot2)
library(lubridate)
library(viridis)
library(tidygeocoder)
library(knitr)
library(crsuggest)
options(tigris_use_cache = TRUE)
remotes::install_github("walkerke/mapboxapi")
library(mapboxapi)
library(rgdal)
library(lehdr)
library(scales)
library(htmlwidgets)
library(htmltools)

```

## The Route 1 Corridor

U.S. Route 1 once served as the major north-south corridor that connected East Coast states. However, the completion of Interstate 95 in the late 1950s drew traffic and business away from the highway. Since then, areas up and down the entirety of U.S. Route 1 have experienced decline and significant change that present challenges to revitalization. As a home to residents and businesses, the Route 1 corridor in Chesterfield County is well-positioned to be one of the county's most vibrant suburban communities to existing and future generations. In close proximity to the City of Richmond and with convenient access to Interstate 95, the corridor is centrally located in the Richmond metro area and could play a pivotal role in the growth and development of the entire region.

Current conditions on the northern section of Route 1 prevent significant reinvestment, but recent efforts by the County improve those conditions and incentivize new and much needed development. The 2018 Northern Jefferson Davis Special Area Plan and the 2019 Northern Jefferson Davis Real Estate Market Study provide Chesterfield County with initial tools to revitalize Route 1. Momentum has continued with the Route 1 Residential Overlay District, the Northern Jefferson Davis Incentive Program, and Greater Richmond Transit Company's Pilot Bus Service.

Much of the new rental housing development has occurred at the southern end of the study area --- pulled towards the intersection of W. Hundred Road (State Route 10) and Route 1, where there is a dense concentration of retail shopping options.

This study focuses its research on the six census tracts that straddle the Route 1 corridor from the Richmond-Chesterfield County border to the north and State Route 10 to the south. This encompasses portions of the Bensley, Bellwood, and northern Chester.

```{r route-one-map}

r1_tracts_list <- c("100300", "100404", "100405", "100406", "100407", "100409")

r1_tracts <- tracts("VA", "Chesterfield",
                    progress_bar = FALSE) |> 
  filter(TRACTCE %in% r1_tracts_list) |> 
  st_transform(4326) |> 
  mutate(neighborhood = case_when(
    TRACTCE == "100300" ~ "Bensley",
    TRACTCE == "100404" ~ "Bellwood",
    TRACTCE == "100405" ~ "Bensley",
    TRACTCE == "100406" ~ "Bellwood",
    TRACTCE == "100407" ~ "Bellwood",
    TRACTCE == "100409" ~ "Northern Chester"
  ))

# hood_pal <- colorFactor(rainbow(3), c("Bensley", "Bellwood", "Northern Chester"))
#   
# r1_neighborhoods <- leaflet(r1_tracts) |> 
#   addTiles() |> 
#   addPolygons(color = ~hood_pal(neighborhood), 
#               weight = 3, 
#               label = ~r1_tracts$NAMELSAD,
#               labelOptions = labelOptions(noHide = F, 
#                                           direction = "auto",
#                                           textsize = "15px")) |> 
#   addLegend("topright",
#             pal = hood_pal,
#             values = ~neighborhood,
#             title = "Route 1 corridor neighborhoods")
# 
# saveWidget(r1_neighborhoods, "maps/r1_neighborhoods.html")

knitr::include_url("maps/r1_neighborhoods.html", height = "500px")

```

## Rental housing supply

The following describes the existing rental housing supply along the Route 1 corridor.

### Number of rental homes

The number of rental homes along the Route 1 corridor has increased by 26 percent between 2010 and 2020 - a total of 708 renter households. Much of this rental housing growth occurred in the latter half of the decade --- from 2014 and on. From 2010 to 2012, rental housing was in decline --- most likely a reflection of the latter year impacts from the Great Recession. During this timeframe, the construction industry struggled to keep pace with the growing demand for new rental housing. From 2019 to 2020, there was a higher estimated percent change (13 percent)in renter homes than in previous years. Although this could be a significant impact of the COVID-19's impact on the rental housing market --- margins of error for the data in 2020 are also higher than previous years; and therefore, these changes should be interpreted with caution.

```{r r1-rhh, fig.cap="Renter households in Route 1 corridor"}

years <- 2010:2020

b25003_vars <- load_variables(2020, "acs5") |> 
  filter(str_sub(name, end = 7) %in% "B25003_")

b25003_raw <- map_dfr(years, function(yr){
  b25003_pull <- get_acs(
    geography = "tract",
    county = "Chesterfield County",
    state = "VA",
    table = "B25003",
    year = yr,
    survey = "acs5",
    cache_table = TRUE,
    geometry = TRUE
  ) |> 
    mutate(year = yr)
  })

b25003_r1_raw <- b25003_raw |> 
  subset(GEOID %in% r1_tracts$GEOID)

b25003_vars_cleaned <- b25003_vars |> 
  separate(label, into = c("est", "total", "tenure"), sep = "!!") |> 
  select(variable = name, tenure) |> 
  drop_na() |> 
  mutate(tenure = case_when(
    tenure == "Owner occupied" ~ "Homeowner",
    tenure == "Renter occupied" ~ "Renter"
  )) |> 
  filter(tenure == "Renter")

b25003_r1 <- b25003_r1_raw |> 
  right_join(b25003_vars_cleaned, by = "variable") |> 
  select(NAME, fips = GEOID, year, tenure, estimate, moe)

b25003_route1 <- b25003_r1 |> 
  group_by(year) |> 
  summarise(estimate = sum(estimate))
  
# Create line graph showing change in renter households across time.

r1_renters_plot <- gg_line(
  b25003_route1,
  x_var = year,
  y_var = estimate,
  y_breaks_n = 5,
  y_zero = TRUE,
  title = "Renter households",
  x_title = element_blank())

r1_renters_plot

  
```

Based on 2010 and 2020 estimates, the increase in rental housing has largely occurred at the northern end of the Route 1 corridor in the Bensley area. All areas saw some increase in renter housing except for Census Tract 1004.04, which covers the eastern side of Route 1 from Falling Creek down to Bellwood Road. This census tract experienced a decrease of 180 renter households.

While unable to determine the causes or from where these renter households came from, this area of Route 1 contains several manufactured home communities and naturally-occurring affordable housing --- all of which place households at greater risk of displacement.

```{r r1-rhh-tract, fig.cap="Change in renter households by tract from 2010 to 2020"}

b25003_r1_10 <- b25003_r1 |> 
  filter(year == 2010) |> 
  select(NAME, fips, year, estimate)

b25003_r1_20 <- b25003_r1 |> 
  filter(year == 2020) |> 
  select(NAME, fips, year, estimate)

b25003_r1_10_20 <- cbind(b25003_r1_10, b25003_r1_20) |> 
  select(NAME, fips, est10 = estimate, est20 = estimate.1, geometry) |> 
  mutate(change = (est20-est10),
         tract = sapply(strsplit(
           as.character(
             str_remove_all(NAME, "\\,")), " "), unlist)[3,],
         tract = fct_reorder(tract, change, .desc = TRUE))

r1_rhh_tract <- gg_hbar_col(b25003_r1_10_20,
                            x_var = change,
                            y_var = tract,
                            col_var = change,
                            title = "Change in renter households by tract from 2010 to 2020",
                            y_labels = function(x) x,
                            x_title = "",
                            col_legend_none = TRUE)

r1_rhh_tract

```

### Multifamily properties

Of the estimated 3,376 occupied rental homes from the U.S. Census Bureau, CoStar captures at most 2,417 of them that are located across 20 multifamily properties. These multifamily properties contain at least 12 rental homes and the majority of these properties (70 percent) are garden-style apartments. The majority (70 percent) of existing properties were built before 1976, and of these fourteen properties, only two have a recorded renovation --- Collindale Apartments (renovated in 1990) and Falling Creek (renovated in 2017).

```{r costar-mf-1, fig.cap= "Total number of multifamily units by property status"}

# Load .csv of CoStar properties. Data was collected by hand drawing boundaries for the necessary census tracts in the CoStar platform. No filters were placed on the search aside from multi-family property.

costar_r1_mf <- read_csv("data/costar_r1_mf.csv") |> 
  clean_names() |> 
  filter(property_address != "8219 Jefferson Davis Hwy") |> 
  filter(property_address != "9608 Jefferson Davis Hwy") |> 
  filter(property_address != "2537 Norcliff Rd") |> 
  filter(property_address != "12329-12331 Jefferson Davis Hwy") |> 
  filter(property_address != "9701 Jefferson Davis Hwy") |> 
  mutate(property_name = case_when(
    property_address == "3145 Parkdale Rd" ~ "Parkdale Maisonettes", 
    property_address == "11240 Jefferson Davis Hwy" ~ "Chester Maisonettes",
    TRUE ~ property_name
  ))

r1_unit_cnt <- costar_r1_mf |> 
  group_by(building_status) |> 
  summarise(units = sum(number_of_units))

r1_unit_cnt_bar <- gg_bar_col(
  r1_unit_cnt,
  x_var = building_status,
  y_var = units,
  col_var = building_status,
  title = "Total number of multifamily units by property status"
)

r1_unit_cnt_bar

```

The city-county border was located much further north before the annexation of Northern Chesterfield by the City of Richmond in 1970. In spite of this change, these older rental properties represent the extent to which rental housing development in the mid-20th century stretched into the county.

```{r costar-mf-2, fig.cap="Map of multifamily properties along Route 1 Corridor"}

# r1_map <- costar_r1_mf |> 
#   st_as_sf(coords = c("longitude", "latitude"), crs=4326, remove=FALSE)
# 
# r1_costar_map <- leaflet(r1_map) |> 
#   addTiles() |> 
#   addPolygons(data = r1_tracts,
#               weight = 2,
#               color = "#666666",
#               fillColor = "#999999",
#               fillOpacity = 0.3) |> 
#   addCircleMarkers(radius = 3,
#                    popup = r1_map$property_name)
# 
# r1_costar_map
# 
# saveWidget(r1_costar_map, "maps/r1_costar_map.html")

knitr::include_url("maps/r1_costar_map.html", height = "500px")

```

### Manufactured home communities

Manufactured housing grew out of the "travel trailer" popularity of the mid-20th century. These trailers evolved into the manufactured housing when the U.S. Department of Housing and Urban Development developed standardized building codes and the the Federal Housing Administration began offering mortgage insurance on both homes and lots.

Communities of manufactured homes grew out of the decline of "travel trailer" camp grounds and the increase in manufactured housing production. With the need for land to place manufactured homes, there were few options aside from existing land where similar types of housing were already permitted, or where a household could afford a plot of land themselves. Land owners also saw a value in developing manufactured home communities for those who wanted the experience of a single-family detached home, but could not afford to purchase.

But the stigma of manufactured housing has plagued both residents and developers for decades. There have been no new manufactured home communities in Virginia in that same amount of time. Nonetheless, manufactured home communities have carved out a particular niche along the housing spectrum, offering an affordable albeit often precarious housing opportunity.

Manufactured home communities offer rental housing opportunities across the county by one of two ways:

1.  A household owns their manufactured home and rents the land in which their home is placed (i.e. paying lot rent); or
2.  A household rents the manufactured home that is owned by the community owner (i.e. paying rent where lot rent is included).

Accurate data on manufactured home communities is difficult to come by. Community owners may allow for the additional of homes on a continuous basis without approval, or some homes may be left abandoned after a tenant has vacated. Anecdotally, some owners have even subdivided a single home into four units to be rented. This makes it difficult to have an accurate count of households.

The northern Route 1 corridor has a substantial number of manufactured home communities --- specifically 10 out of the county's known 17 manufactured home communities are located in the area. This accounts for at least 514 individual manufactured homes, or 31 percent of all homes located in a manufactured home community. This includes the sixth largest manufactured home park in the county, Shady Hill, which was recently purchased in July 2022.

```{r r1-mhc, fig.cap="Map of manufactured home communities along Route 1"}

# Use MHCCV study instead; supplement additional MHCs.

# mhc <- read_csv("data/mhccv_chesterfield.csv") 
# 
# mhc <- mhc |> 
#   transform(fulladdress = paste(mhc$address, mhc$county, mhc$state, mhc$zip, sep = ", "))|> 
#   select(name, fulladdress, units, units_mhccv, corridor)
# 
# mhc_coded <- mhc |> 
#   geocode(address = fulladdress,
#           method = 'geocodio',
#           full_results = TRUE,
#           unique_only = FALSE,
#           lat = Latitude,
#           long = Longitude) |> 
#   mutate(Latitude = case_when(
#     name == "Holiday Mobile Home Park" ~ 37.393355,
#     TRUE ~ Latitude
#   )) |> 
#   mutate(Longitude = case_when(
#     name == "Holiday Mobile Home Park" ~ -77.427561,
#     TRUE ~ Longitude
#   ))
# 
# saveRDS(mhc_coded, file = "data/mhc_coded.rds")

mhc_coded <- readRDS("data/mhc_coded.rds")

mhc_coded_r1 <- mhc_coded |> 
  filter(corridor == "Route 1 - N")

# sum(mhc_coded_r1$units_mhccv)

# sum(mhc$units_mhccv)

# r1_mhc_map <- leaflet(mhc_coded_r1) |> 
#   addTiles() |> 
#   addCircleMarkers(
#     radius = ~ (units_mhccv/5),
#     color = "orangered",
#     stroke = TRUE,
#     fillOpacity = 0.5,
#     popup = ~paste(name, "<br> Units:", units_mhccv)
#   )
# 
# saveWidget(r1_mhc_map, "maps/r1_mhc_map.html")

knitr::include_url("maps/r1_mhc_map.html", height = "500px")

```

Notable among these communities is Bermuda Estates, which was purchased by affordable housing nonprofit, project:HOMES, in September 2020. Only one of two nonprofit owned and managed manufactured home communities in the Commonwealth, Bermuda Estates has seen significant infrastructure improvements and the replacement of homes with new energy efficient manufactured home models by project:HOMES.

```{r r1-mhc-list}

mhc_coded_r1 |> 
  arrange(desc(units_mhccv)) |> 
  select(1,4) |> 
  kable(caption = "Manufactured home communities along northern Route 1 corridor",
        align = "lr",
        col.names = c("Name", "Estimated homes")) %>% 
  kableExtra::kable_styling(
    bootstrap_options = c("condensed", "hover", "striped"))

```

### Single-family rentals

As mentioned previously in [Chapter 11](#part-2a-1), the growth of the single-family home rental (SFR) market is impacting all parts of the county. And the Route 1 corridor is no exception.

Along the northern Route 1 corridor, there is an estimated 1,008 single-family home rentals --- about 20 percent of all single-family homes the area.[^part-2b-1-1] The highest concentration of SFR is within Census Tract 1003 (Bensley), where 28 percent of all single-family homes are believed to be renter occupied.

[^part-2b-1-1]: This analysis was conducted by matching owner mailing address to physical address for all parcels wherein the land use code is "Single Dwelling." This analysis does not account for condominiums and therefore could be considered an undercount.

SFR is a growing demand among renters as homeownership continues to be out of reach for many, but it also serves a growing demand among households looking for greater space and privacy not offered in apartments. As seen in [Chapter 13](#part-2a-3), nearly 54 percent of recent multifamily housing is two-bedrooms or less, leaving many larger households competing for less supply. SFR is filling the gap where multifamily developers are often falling short due to increasing construction costs and public opposition.

```{r sfr-r1, fig.cap="Percent of single-family homes that are renter-occupied by tract", message=FALSE}

ch_sfh <- st_read("data/shp/ch_sfh.shp",
                  quiet = TRUE)

sfr_r1 <- ch_sfh |>
  st_join(left = FALSE, r1_tracts["NAMELSAD"]) |>
  select(address, imprvmn, ownrshp, ownr_zp, ownr_st, tract = NAMELSAD, geometry) |>
  filter(imprvmn > 0)

# sfr_r1_summary <- sfr_r1 |> 
#   st_drop_geometry() |> 
#   group_by(tract, ownrshp) |> 
#   summarise(count = n_distinct(address)) |> 
#   mutate(total_sfh = case_when(
#     tract == tract ~ sum(count))
#   ) |> 
#   mutate(percent_sfh = count/total_sfh,
#          tract = sapply(strsplit(
#            as.character(
#              str_remove_all(tract, "\\,")), " "), unlist)[3,]) |> 
#   filter(ownrshp == "Renter-occupied SFH") |> 
#   ungroup() |> 
#   mutate(tract = fct_reorder(tract, percent_sfh, .desc = TRUE))
# 
# write_rds(sfr_r1_summary, "data/sfr_r1_summary.rds")

sfr_r1_summary <- read_rds("data/sfr_r1_summary.rds")
  
sfr_r1_pct <- gg_hbar_col(sfr_r1_summary,
                          x_var = percent_sfh,
                          y_var = tract,
                          col_var = percent_sfh,
                          title = "Percent of single-family homes that are renter-occupied by tract",
                          x_labels = label_percent(),
                          y_labels = function(x) x,
                          col_legend_none = TRUE,
                          x_title = "")

sfr_r1_pct

```

The majority (68 percent) of owners of SFR along the corridor live somewhere else in the county, while 25 percent live outside of the county but somewhere else in Virginia. Fewer than 7 percent of SFR owners live outside of Virginia --- the largest share of which has an owner in Florida.

```{r sfr_r1_owners}

chesterfield_zips <- read_rds("data/chesterfield_zips.rds")

zip_list <- chesterfield_zips$ZCTA5CE10

# There is a duplicate address that I end up filtering out with a distinct count.

rental_class_r1 <- sfr_r1 |> 
  st_drop_geometry() |> 
  filter(ownrshp == "Renter-occupied SFH") %>%
  mutate(owner_location = case_when(
    ownr_zp %in% zip_list ~ "Owner in Chesterfield",
    ownr_st == "VA" ~  "Owner in Virginia",
    TRUE ~ "Owner out of state"
  ))

rental_class_r1_sum <- rental_class_r1 |> 
  group_by(owner_location) |> 
  summarise(count = n_distinct(address)) |> 
  mutate(pct = percent(count/sum(count), 1))

rental_class_r1_sum |> 
  kable(caption = "Single-family rentals in Route 1 corridor by owner location",
        align = "lrr",
        col.names = c("Ownership", "Number", "Percent")) |> 
  kableExtra::kable_styling(
    bootstrap_options = c("condensed", "hover", "striped")
  )

```

### Rental prices

Median rents in the northern Route 1 corridor have fluctuated in the last decade. But increases in the typical rent have most significantly occurred in the southern part of Bellwood (Census Tract 1004.07) where Colony Village was developed. In this part of the corridor, median rent has increased by 24 percent from 2010 to 2020.

```{r acs-r1-rent, fig.cap="Median inflation-adjusted rent by tract: 2010 to 2020"}

years <- 2010:2020

b25064_vars <- load_variables(2020, "acs5") |> 
  filter(str_sub(name, end =6) %in% "B25064")

b25064_raw <- map_dfr(years, function(yr){
  b25064_pull <- get_acs(
    geography = "tract",
    county = "Chesterfield County",
    state = "VA",
    table = "B25064",
    year = yr,
    survey = "acs5",
    cache_table = TRUE,
    geometry = TRUE
  ) %>%
    mutate(year = yr)
  })

b25064_r1_raw <- b25064_raw |> 
  subset(GEOID %in% r1_tracts$GEOID)

cpi <- read_excel("data/CPI_U_RS.xlsx")
cpi <- cpi |>  
  rename(year = Year,
         priceindex = Index) |> 
  transform(year = as.numeric(year))

r1_rent_cpi <- b25064_r1_raw |> 
    left_join(cpi, by = 'year') |> 
  transform(dollars20 = ((381.2/priceindex)*estimate)) |> 
  select(GEOID, NAME, year, dollars20) |> 
  separate(NAME, into = c("NAMELSAD", "county", "state"), sep = ",") |> 
  transform(year_char = as.character(year))

r1_rent_change <- r1_rent_cpi |> 
  select(NAMELSAD, year, dollars20) |> 
  mutate(tract = sapply(strsplit(
           as.character(
             str_remove_all(NAMELSAD, "\\,")), " "), unlist)[3,]) |> 
  st_drop_geometry()

gg_line_col_facet(r1_rent_change,
                  x_var = year,
                  y_var = dollars20,
                  col_var = tract,
                  facet_var = tract,
                  alpha_point = 0,
                  size_line = 0.75,
                  col_legend_none = TRUE,
                  y_labels = label_dollar(),
                  facet_labels = function(x) x,
                  title = "Median inflation-adjusted rent by tract: 2010 to 2020",
                  y_title = "Median inflation-adjusted rent",
                  x_title = ""
                  )

```

There are clear differences in median rents between the northern and southern sections of the Route 1 corridor. Northern Chester and southern Bellwood had median rents above \$1,300 in 2020 --- \$1,314 and \$1,367, respectively. Median rents in the northern part of the corridor ranged from \$780 to \$1,059 -- hundreds of dollars less in all cases than the southern part of the corridor.

Much of this difference in rental markets is no doubt a result of newer developments like Colony Village and The Jane at Moore's Lake. There have been few new multifamily developments in the northern section aside from Better Housing Coalition developments.

```{r acs-r1-rent1, fig.cap="Median inflation-adjusted rent by neighborhood: 2010 to 2020"}

r1_rent_nhood <- r1_rent_cpi |> 
  mutate(neighborhood = case_when(
    NAMELSAD == "Census Tract 1003" ~ "Bensley",
    NAMELSAD == "Census Tract 1004.05" ~ "Bensley",
    NAMELSAD == "Census Tract 1004.04" ~ "Bellwood",
    NAMELSAD == "Census Tract 1004.06" ~ "Bellwood",
    NAMELSAD == "Census Tract 1004.07" ~ "Bellwood",
    NAMELSAD == "Census Tract 1004.09" ~ "Northern Chester",
  )) |> 
  select(NAMELSAD, neighborhood, year, dollars20) |> 
  mutate(tract = sapply(strsplit(
           as.character(
             str_remove_all(NAMELSAD, "\\,")), " "), unlist)[3,]) |> 
  st_drop_geometry()

gg_line_col_facet(r1_rent_nhood,
            x_var = year,
            y_var = dollars20,
            col_var = tract,
            facet_var = neighborhood,
            alpha_point = 0,
            size_line = 0.75,
            y_labels = label_dollar(),
            col_labels = function(x) x,
            facet_labels = function(x) x,
            title = "Median inflation-adjusted rent by neighborhood: 2010 to 2020",
            y_title = "Median inflation-adjusted rent",
            x_title = ""
            )


```

#### Multifamily rents

CoStar's analytics allows for a broad snapshot of average rent data along Route 1 on a quarter-by-quarter basis. Average rent per apartment was on a steady decline from 2002 until the rental market began to recover in 2013. It was not until Q3 2014 that average rent began to experience consistent increases quarter over quarter from \$1,109 to \$1,214 in the most recent 2022 quarter.

From 2017 to early 2020, the typical average rent increase was about \$3 but between Q1 2020 and Q2 2020 the average rent jumped \$15 from \$1,195 to \$1,210. It was during this timeframe that the pandemic began to impact housing markets, leading to significantly low rental vacancy rates as the eviction moratorium was put in place and increasing demand for housing away from the denser urban environment.

```{r costar-r1-rent, fig.cap="CoStar average asking rent for Route 1 corridor"}

# Use CoStar Multi-family properties search. Draw with polygon tool on map the outline of the Route One census tracts. Filter out properties from previous. Download inflation adjusted history for all years. 

costar_r1_rent <- read_csv("data/costar_r1_rent.csv") |> 
  clean_names() |> 
  mutate(period = case_when(
    period == "2022 Q3 QTD" ~ "2022 Q3",
    TRUE ~ period)) |> 
  mutate(period = yq(period)) |> 
  mutate(current_search = parse_number(current_search)) |> 
  mutate(year = year(period))

colnames(costar_r1_rent)[2] <- "rent"

gg_line(costar_r1_rent,
        x_var = period,
        y_var = rent,
        y_zero = TRUE,
        alpha_point = 0,
        size_line = 0.75,
        x_labels = label_date(format = "%Y"),
        y_labels = label_dollar(),
        x_title = "",
        y_title = "Average asking rent (inflation-adjusted)",
        title = "CoStar average asking rent for Route 1 corridor") +
  ggplot2::scale_x_date(limits = c(as.Date("1999-12-01"), as.Date("2022-07-31")))


```

Average rent disaggregated by number of bedrooms shows fairly steady increases for all bedroom types, especially one- and two-bedroom apartments. Studios and three-bedroom apartments in the area have seen decreasing rents in recent years. In fact, average rent for three bedroom apartments are now \$56 cheaper (\$1,431) than they were at the start of 2012 (\$1,487).

```{r costar-r1-brent, fig.cap="CoStar average asking rent for Route 1 corridor by bedroom"}

# Use CoStar Multi-family properties search. Draw with polygon tool on map the outline of the Route One census tracts. Filter out properties from previous. Download inflation adjusted history for all years. 

costar_r1_brent <- read_csv("data/costar_r1_brent.csv") |> 
  clean_names() |> 
  mutate(period = case_when(
    period == "2022 Q3 QTD" ~ "2022 Q3",
    TRUE ~ period)) |> 
  pivot_longer(
    cols = 2:5,
    names_to = "br",
    values_to = "rent"
  ) |> 
  mutate(br = case_when(
    br == "studio" ~ "Studio",
    br == "x1_bed" ~ "1 bedroom",
    br == "x2_beds" ~ "2 bedroom",
    br == "x3_beds" ~ "3 bedroom"
  )) |> 
  mutate(period = yq(period)) |> 
  mutate(year = year(period)) |> 
  mutate(rent = parse_number(rent)) |> 
  filter(year > 2011) |> 
  mutate(br = fct_reorder(br, rent, .fun = max, .desc = TRUE))

gg_line_col(costar_r1_brent,
            x_var = period,
            y_var = rent,
            col_var = br,
            alpha_point = 0,
            size_line = 0.75,
            title = "CoStar average asking rent for Route 1 corridor by bedroom",
            y_labels = label_dollar(),
            x_labels = label_date(format = "%Y"),
            y_title = "Average asking rent (inflation-adjusted)",
            x_title = "",
            y_zero = TRUE,
            col_title = "") +
  ggplot2::scale_x_date(limits = as.Date(c("2011-12-01", "2022-08-01")))

```

#### Single-family rents

Single-family rentals are not often listed via sources that provide consistent or reliable data. Facebook groups and other social networks often play a major role in advertising SFR, but the Central Virginia Regional Multiple Listing Service (CVR MLS) does pick up some of this market. Within the last year, there were 44 single-family homes rented through the MLS.

The average listed rent for one of these SFR was \$1,336 --- nearly \$100 less the average rent for a three-bedroom apartment. Single-family detached homes fetch higher rental prices versus condominiums or duplexes.

```{r mls-sfr, fig.cap="Listed MLS rents in Route 1 corridor"}

# Use MLS Search RNT search. Filters: Status/Date Range: Active, Leased - 0-365; Map: draw outline for census tracts and export. From July 2022.

mls_r1_sfr <- read_csv("data/mls_r1_sfr.csv") |> 
  clean_names() |> 
  mutate(sales_date = mdy(sales_date),
         list_price = parse_number(list_price),
         year = as.numeric(year(sales_date)),
         day = as.numeric(yday(sales_date)),
         date = year + day/365)

# mean(mls_r1_sfr$list_price, na.rm = TRUE)

gg_smooth_col(mls_r1_sfr,
         x_var = date,
         y_var = list_price,
         col_var = type,
         y_labels = label_dollar(),
         col_labels = function(x) x,
         x_title = "",
         y_title = "Listed rent",
         title = "Listed MLS rents in Route 1 corridor") +
  ggplot2::scale_x_continuous(limits = c(2017.5, 2022.3))

```

The majority of SFR listed through MLS are three-bedroom homes (54 percent), while 18 percent are four-bedrooms or more --- an option that apartments do not often offer.

```{r mls-sfr1, fig.cap="Percent of MLS-listed SFR by bedrooms in Route 1 corridor"}

# Spread of bedrooms

mls_r1_sfr_br <- mls_r1_sfr |> 
  mutate(number_bedrooms = as.character(number_bedrooms)) |> 
  group_by(number_bedrooms) |> 
  summarise(count = n_distinct(address)) |> 
  transform(percent = count/sum(count))

gg_bar_col(mls_r1_sfr_br,
           x_var = number_bedrooms,
           y_var = percent,
           col_var = number_bedrooms,
           x_title = "Number of bedrooms",
           y_title = "",
           y_labels = label_percent(),
           col_legend_none = TRUE,
           title = "Percent of MLS-listed SFR by bedrooms in Route 1 corridor")


```


### Conditions

Aging rental properties require substantial capital in order to maintain properties. Even properties built in the 1980s are approaching half a century in age. Along the Route 1 corridor, there are 1,812 rental homes that were built before 1980. The largest share of these homes are located in the Bensley area (Census Tracts 1003 and 1004.04).

```{r acs-yrblt, fig.cap="Percent of rental units built before 1980 by tract"}

b25036_vars <- load_variables(2020, "acs5") |> 
  filter(str_sub(name, end = 6) %in% "B25036")

b25036_raw <- get_acs(
  geography = "tract",
  county = "Chesterfield County",
  state = "VA",
  table = "B25036",
  year = 2020,
  survey = "acs5",
  cache_table = TRUE
  )

b25036_r1_raw <- b25036_raw |> 
  subset(GEOID %in% r1_tracts$GEOID)

# Maybe keep all households in order to do percentages across entire housing stock? Or just rental housing stock?

b25036_vars_cleaned <- b25036_vars |> 
  separate(label, into = c("est", "total", "tenure", "yrblt"), sep = "!!") |> 
  select(variable = name, tenure, yrblt) |> 
  filter(tenure == "Renter occupied:") |> 
  drop_na() |> 
  mutate(tenure = "Renter")

b25036_r1 <- b25036_r1_raw |> 
  right_join(b25036_vars_cleaned, by = "variable")

b25036_r1_grp <- b25036_r1 |> 
  mutate(yrblt = case_when(
    yrblt == "Built 1939 or earlier" ~ "1939 or earlier",
    yrblt == "Built 1940 to 1949" ~ "1940 to 1959",
    yrblt == "Built 1950 to 1959" ~ "1940 to 1959",
    yrblt == "Built 1960 to 1969" ~ "1960 to 1979",
    yrblt == "Built 1970 to 1979" ~ "1960 to 1979",
    yrblt == "Built 1980 to 1989" ~ "1980 to 1999",
    yrblt == "Built 1990 to 1999" ~ "1980 to 1999",
    yrblt == "Built 2000 to 2009" ~ "2000 to 2009",
    yrblt == "Built 2010 to 2013" ~ "2010 or later",
    yrblt == "Built 2014 or later" ~ "2010 or later"
  )) |> 
  mutate(yrgrp = case_when(
    yrblt == "2000 to 2009" ~ yrblt,
    yrblt == "2010 or later" ~ yrblt,
    yrblt == "1980 to 1999" ~ yrblt,
    TRUE ~ "Pre-1980"
  )) |> 
  mutate(total_renters = sum(estimate))

# Total renter households is 3,376

b25036_r1_grp <- b25036_r1_grp |> 
  group_by(yrgrp, NAME) |> 
  summarise(estimate = sum(estimate)) |> 
  filter(yrgrp == "Pre-1980") |> 
  transform(percent = estimate/3376) |> 
  ungroup() |> 
  mutate(tract = sapply(strsplit(
           as.character(
             str_remove_all(NAME, "\\,")), " "), unlist)[3,],
         tract = fct_reorder(tract, percent, .desc = TRUE))
  

gg_hbar_col(b25036_r1_grp,
            x_var = percent,
            y_var = tract,
            col_var = percent,
            title = "Percent of rental units built before 1980 by tract",
            x_labels = label_percent(),
            y_labels = function(x) x,
            col_legend_none = TRUE,
            x_title = "")

```

Of the 23 CoStar-listed multifamily properties, 14 (61 percent) were constructed before 1980. There was no major multifamily development activity again until 2000 when Better Housing Coalition constructed Winchester Green Apartments' first phase. There has been little new multifamily development along the corridor during the last two decades --- activity has largely been spearheaded by Better Housing Coalition and Emerson Companies. With few newer developments, there are fewer options for those who are looking to rent along the corridor --- either having to choose a pre-1980s apartment, which are often in need of renovation, or among new luxury apartments that are often outside the budgets of existing renters along the corridor.

```{r costar-mf-3, fig.cap="Multifamily units in Route 1 corridor by year built"}

costar_r1_yrblt <- costar_r1_mf |> 
  select(year_built, property_address, building_status, number_of_units)

gg_bar_col(costar_r1_yrblt,
           x_var = year_built,
           y_var = number_of_units,
           col_var = building_status,
           size_width = 1,
           x_labels = label_date(format = "%Y"),
           x_title = "",
           y_title = "Number of units",
           title = "Multifamily units in Route 1 corridor by year built") +
  ggplot2::scale_x_continuous(
    limits = c(1956, 2024),
    breaks = c(1960, 1970, 1980, 1990, 2000, 2010, 2020)
  )

```

CoStar's building rating system also provides a snapshot of condition of multifamily properties. Eighty-three percent of multifamily properties along the corridor are three-star or less --- meaning that in terms of quality and amenities that these buildings are relatively average or simply functional. In comparison, four-star properties are "are constructed with higher end finishes and specifications, providing desirable amenities to residents and designed/built to competitive and contemporary standards," while five-star properties are "the luxury end of multi-family buildings defined by finishes, amenities, the overall interior/exterior design and the highest level of specifications for its style..."

```{r costar-mf-4, fig.cap="Percent of rental units in Route 1 corridor by CoStar star rating"}

costar_r1_stars <- costar_r1_mf |> 
  select(star_rating, property_address, building_status, number_of_units) |> 
  mutate(star_rating = paste(star_rating, " stars")) |> 
  group_by(star_rating) |> 
  summarise(units = sum(number_of_units)) |> 
  mutate(pct = units/sum(units))

  
gg_bar_col(costar_r1_stars,
           x_var = star_rating,
           y_var = pct,
           col_var = star_rating,
           x_title = "",
           y_title = "",
           col_legend_none = TRUE,
           y_labels = label_percent(),
           title = "Percent of rental units in Route 1 corridor by CoStar star rating"
           )

```

In 2016, the Manufactured Home Community Coalition of Virginia conducted an assessment of manufactured home communities in Central Virginia. Their assessment included all but three of the communities identified in this study.

Based on an analysis of community socio-economic conditions, spatial patterns, and design characteristics, MHCCV created a typology that helps understand community conditions and potential areas for concern. To supplement their typology, communities not identified previously were assigned a typology.[^part-2b-1-2]

[^part-2b-1-2]: Bermuda Estates was assigned a completely new typology due to its ownership by nonprofit, project:HOMES. This typology emphasizes the stability of the park and the continued investments in the community given project:HOMES' overall mission.

Of the ten communities located along the corridor, six are either obsolete or under pressure. Obsolete communities were found to have "severe, long-standing deficiencies in infrastructure, housing condition, private property, tenure, amenities, and management. Under pressure communities often house low-income families with children and are located in areas close to daily needs. They have poor conditions and are at the most risk for redevelopment.

```{r mhccv-condition, fig.cap="Percent of MH units in Route 1 corridor by park typology"}

mhc_con <- read_csv("data/mhccv_chesterfield.csv") |> 
  filter(corridor == "Route 1 - N") |> 
  group_by(typology) |> 
  summarise(units = sum(units)) |> 
  mutate(pct = units/sum(units),
         fct_reorder(typology, pct, .desc = TRUE))

gg_bar_col(mhc_con,
           x_var = typology,
           y_var = pct,
           col_var = typology,
           x_title = "",
           y_title = "",
           col_legend_none = TRUE,
           y_labels = label_percent(),
           title = "Percent of MH units in Route 1 corridor by park typology"
           )

```

## Single-family rental versus purchase

For renter households along the corridor, the ability to purchase a home may be out of reach for many. But SFRs are filling a gap for households looking for the opportunity to live in a single-family detached home --- providing more space and privacy for growing families. At the same time, SFRs are typically the entry-level homes that many first-time homebuyers would be able to afford. 

```{r r1-renter-income}

b25119_vars <- load_variables(2020, "acs5") %>%
  filter(str_sub(name, end = 6) %in% "B25119")

r1_b25119_raw <- get_acs(
    geography = "tract",
    county = "Chesterfield County",
    state = "VA",
    table = "B25119",
    year = 2020,
    survey = "acs5",
    cache_table = TRUE
  ) 

b25119_vars_cleaned <- b25119_vars %>%
  separate(label, into = c("est", "income", "total", "tenure"), sep = "!!") %>% 
  select(variable = name, tenure)%>%
  mutate(tenure = case_when(
    tenure == "Owner occupied (dollars)" ~ "Homeowner",
    tenure == "Renter occupied (dollars)" ~ "Renter",
    TRUE ~ "All households"
  ))

r1_b25119_data <- r1_b25119_raw %>%
  right_join(b25119_vars_cleaned, by = "variable") %>%
  select(NAME, tenure, estimate, moe)  %>%
  separate(NAME, into = c("tract", "county", "state"), sep = ",")

r1_tract_names <- c("Census Tract 1003", "Census Tract 1004.04",
                    "Census Tract 1004.05", "Census Tract 1004.06",
                    "Census Tract 1004.07", "Census Tract 1004.09")

r1_medinc <- r1_b25119_data %>%
  filter(tract %in% r1_tract_names) %>% 
  filter(tenure == "Renter")

```

```{r r1-med-sales}

r1_sales <- read_csv("data/mls_r1_sales_72622.csv")

r1_sales_med <- r1_sales |> 
  clean_names() |> 
  select(sales_price, sales_date) %>% 
  mutate(sales_date = mdy(sales_date),
         year = floor_date(sales_date, "year"),
         sales_price = as.numeric(gsub('[\\$|,]','', sales_price))) %>% 
  summarise(median = median(sales_price))

```

In the last year, the median home sales price for a home along the corridor was \$265,000, which would require a monthly mortgage payment of \$1,707.60. This is nearly \$400 more than the price of a SFR in the area --- \$1,336.87 a month.

```{r r1-home-price}

library(optiRum)

r1_msp <- 265000
downpayment <- 0.05 # 5% downpayment
r1_principal <- r1_msp - (r1_msp * downpayment)
closingcosts <- 0.015 # 1.5% closing costs
r1_loanamt <- r1_principal/(1 - closingcosts) # Closing costs added to loan amount 
intrate <- 0.0554 # Current interest rate from Freddie Mac -- 7/26/22 rate is 5.54%
utilities <- 250 # Assume $250/month for utilities

r1_payment <- abs(PMT((intrate/12), 360, r1_loanamt)) + 250

r1_inc_needed <- ((r1_payment*10)/2.8)*12

r1_labels <- c("Median sales price",
            "Downpayment",
            "Closing costs",
            "Loan amount",
            "Interest rate",
            "Monthly utilities",
            "Monthly payment",
            "Income needed to buy home")

r1_values <- c("$265,000",
            "5.0%",
            "1.5%",
            "$255,584",
            "5.54%",
            "$250",
            "$1,707.60",
            "$73,183")

data.frame(x = r1_labels, y = r1_values) %>% 
  kable(caption = "Calculated income needed to buy median-priced home in the study area",
        align = "lr",
        col.names = c("Variable", "Value")) %>% 
  kableExtra::kable_styling(
    bootstrap_options = c("condensed", "hover", "striped")) %>% 
  kableExtra::row_spec(8, bold=TRUE)

```

In order to afford the median home sales price, a household would need to make \$73,183 annually, while an SFR would require \$53,475 --- almost \$20,000 less.

```{r r1-sfr-price}

# $1336.87 is the average price for SFR in the last year.

avg_sfr_price <- 1336.87
sfr_income <- ((avg_sfr_price*10)/3)*12

sfr_labels <- c("Average rent for single-family home",
                "Income needed")

sfr_values <- formattable::currency(c(avg_sfr_price, sfr_income))

data.frame(x = sfr_labels, y = sfr_values) %>% 
  kable(caption = "Calculated income needed to rent single-family home in the Route 1 corridor",
        align = "lr",
        col.names = c("Variable", "Value")) %>% 
  kableExtra::kable_styling(
    bootstrap_options = c("condensed", "hover", "striped")) %>% 
  kableExtra::row_spec(2, bold=TRUE)

```

Based on the most recent ACS estimates for renter household incomes, the typical renter in most Census tracts would not be able to either rent a SFR nor purchase the typical home in the area. Renters in southern Bellwood and northern Chester are more likely to afford a SFR, but with their incomes they are still nearly \$10,000 short of being able to purchase a home priced at \$265,000.

```{r sfr-mls-bar, fig.cap="Renter income and income needed to purchase or rent single-family home in Route 1 corridor"}

x <- c("Census Tract 1003", "Census Tract 1004.04", "Census Tract 1004.05", "Census Tract 1004.06", "Census Tract 1004.07", "Census Tract 1004.09", "Rent single-family home", "Purchase single-family home")
y <- c(35906, 32014, 39477, 25861, 64896, 63783, 53475, 73183)
z <- c("Median renter income", "Median renter income","Median renter income","Median renter income","Median renter income","Median renter income", "Income needed", "Income needed")

sfr_mls_bar <- data.frame(x, y, z) |> 
  mutate(x = fct_reorder(x, y, .desc = TRUE))

gg_hbar_col(sfr_mls_bar,
            x_var = y,
            y_var = x,
            col_var = z,
            x_labels = label_dollar(),
            y_labels = function(x) x,
            x_title = "",
            y_title = "",
            col_title = "",
            title = "Renter income and income needed to purchase or rent single-family home"
            ) +
  ggplot2::geom_text(
    aes(x = x, y = (y - 7500), label = label_dollar()(y)),
    size = 3.5, color = "white") +
  ggplot2::theme(
    legend.position = "top",
    legend.justification = "center",
    legend.direction = "horizontal"
  )

```

With homeownership being out of reach for many in the area, the next best option is often renting a single-family home. Low supply of homes for sale is often being exacerbated by owners or investors converting potential starter home opportunities into rental properties. Although this is meeting a demand in the rental market, the opportunity to reach the first rung of the homeownership ladder is so often pushed further away when the cost to rent a home is only a few hundred dollars away from being able to afford a monthly mortgage.

## Proximity to amenities

Being close to amenities like grocery stores and employment can make a difference in housing affordability for many families on a tight budget. Less time spent traveling often means less money spent on personal vehicle maintenance and gas. It also means more time to spend with family members and more savings that can be spent on housing costs. 

### Public transportation

Public transportation is not prevalent throughout Chesterfield County. But in March 2020, the [Greater Richmond Transit Company (GRTC)](http://ridegrtc.com/statistics-reports/projects-plans/chesterfield-route-1-local-bus-service) partnered with Chesterfield County and the Department of Rail and Public Transportation (DRPT) to pilot local bus service from Falling Creek to John Tyler Community College. Along the Route 1 corridor, there are 24 stops --- 12 along each north and south side.

Local bus service provides those without personal vehicles greater access to employment opportunities and the ability to reach community amenities such as grocery stores. Of the 23 properties along the corridor, 19 are within a half mile walking distance of a bus stop.

In fact, the average distance of properties along this section of the corridor to a bus stop is 0.42 miles. This allows for nearly 2,000 renter households with less than a half mile access to bus service to the City of Richmond, John Tyler Community College, or retail at the intersection of Route 1 and Route 10.

However, this access is slightly more difficult for renters living in apartment communities with affordable rents. One-in-four of all rent-restricted apartments are beyond 1/2 mile walking distance to a transit stop, compared to just 13 percent of all market-rate apartments in the corridor.

```{r r1-transit-setup, eval=FALSE}

# Load CoStar properties and change 'Market/Affordable' to just 'Affordable'

costar_r1_map <- costar_r1_mf |>
  st_as_sf(coords = c("longitude", "latitude"),
           crs = 4326) |> 
  mutate(rent_type = str_remove_all(rent_type, "Market/")) |> 
  mutate(property_id = 1:nrow(costar_r1_mf))

va_crs <- suggest_top_crs(costar_r1_map, units = "m",
                          inherit_gcs = FALSE)

r1_prj <- st_transform(costar_r1_map, va_crs)

r1_tracts_map <- tracts("VA", "Chesterfield", year = 2021) |>
  st_transform(va_crs)

costar_r1_tracts <- st_filter(r1_tracts_map, r1_prj)

stops <- st_read("data/grtc/Stops_May2022.shp") |> 
  st_transform(va_crs)

r1_network_buffer <- mb_isochrone(r1_prj,
                                  profile = "walking",
                                  distance = 805)

library(nngeo)

nearest_stops <- st_nn(r1_prj, stops, k = 20)

```

```{r r1-transit-analysis, eval=FALSE}

costar_stop_walking <- imap(nearest_stops, ~{
  
  property <- r1_prj[.y,]
  
  nearby_stops <- stops[.x, ]

  mb_matrix(origins = property,
            destinations = nearby_stops,
            profile = "walking",
            output = "distance")}) |> 
  reduce(rbind) |> 
  apply(1, min) |> 
  magrittr::divide_by(1609.34)

r1_trans_map <- costar_r1_map |>
   mutate(
     walk_to_transit = costar_stop_walking,
     transit_nearby = case_when(
       walk_to_transit <= 0.5 ~ "1/2 mile or less",
       walk_to_transit > 0.5 ~ "More than 1/2 mile"),
     property_name = fct_reorder(property_name, walk_to_transit)
   )

write_rds(r1_trans_map, "data/r1_trans_map.rds")

# mean(r1_trans_map$walk_to_transit)
# 0.4238681

```

```{r r1-transit-chart, fig.cap="Percent of units in Route 1 corridor near transit by rent type"}

r1_trans_map <- read_rds("data/r1_trans_map.rds")

r1_trans_sum <- r1_trans_map |> 
  st_drop_geometry() |>
  group_by(rent_type, transit_nearby) |> 
  summarise(units = sum(number_of_units)) |> 
  drop_na() |> 
  mutate(pct = units/sum(units))

gg_bar_col_facet(r1_trans_sum,
                 x_var = transit_nearby,
                 y_var = pct,
                 col_var = transit_nearby,
                 facet_var = rent_type,
                 x_title = "",
                 y_title = "",
                 x_labels = element_blank(),
                 col_labels = function(x) x,
                 y_labels = label_percent(),
                 y_breaks_n = 5,
                 title = "Percent of units in Route 1 corridor near transit by rent type"
                 )

```


### Schools

Within the footprint of the Route 1 corridor study area, there are four Chesterfield County Public Schools (CCPS). These include:
- Bensley Elementary School
- Bellwood Elementary School
- C.E. Curtis Elementary School
- Thomas Dale High School

Studies have found that longer commute times have negative impacts on students, including less time spent on activities that promote greater health outcomes.^[Voulgaris CT, Smart MJ, Taylor BD. Tired of Commuting? Relationships among Journeys to School, Sleep, and Exercise among American Teenagers. Journal of Planning Education and Research. 2019;39(2):142-154. doi:10.1177/0739456X17725148] Researchers generally define "long" school commutes as those greater than 30 minutes one-way.

Multifamily properties along the corridor are all within a 30 minute drive of at least one Chesterfield County Public School. In fact, all multifamily properties are fewer than eight minutes away from a school. The average time to at least one CCPS school is slightly more than five minutes.

Still, the affordable communities are further away on average compared to market-rate properties. All but one rent-restricted community has a drive time of more than six minutes. This may detrimentally affect students who walk to school.

```{r r1-school-map, eval=FALSE}

schools <- st_read("https://services3.arcgis.com/TsynfzBSE6sXfoLq/ArcGIS/rest/services/Administrative/FeatureServer/15/query?outFields=*&where=1%3D1&f=geojson") |> 
  st_transform(va_crs)

nearest_schools <- st_nn(r1_prj, schools, k = 20)

```

```{r r1-schools-setup, eval=FALSE}

# I think I would want to understand the number of schools within a distance of certain properties and what schools those are. 

r1_school_driving <- imap(nearest_schools, ~{
  
  property <- r1_prj[.y,]

  nearby_schools <- schools[.x, ]

  mb_matrix(origins = property,
            destinations = nearby_schools,
            profile = "driving",
            output = "duration")
}) |> 
  reduce(rbind) |> 
  apply(1, min)

r1_schools_map <- costar_r1_map |>
  st_drop_geometry() |> 
  mutate(
    minutes_to_school = r1_school_driving,
    school_nearby = ifelse(minutes_to_school <= 30, 1, 0),
    ) |> 
  drop_na(rent_type) |> 
  mutate(property_address = fct_reorder(property_address, minutes_to_school))

write_rds(r1_schools_map, "data/r1_schools_map.rds")

# mean(r1_schools_map$minutes_to_school)
# 5.360217

```

```{r r1-schools-chart, fig.cap="Driving time to schools in Route 1 corridor by rent type"}

r1_schools_map <- read_rds("data/r1_schools_map.rds")

gg_bar_col(r1_schools_map,
           x_var = property_address,
           y_var = minutes_to_school,
           col_var = rent_type,
           x_labels = element_blank(),
           x_title = "Properties",
           title = "Driving time to schools in Route 1 corridor by rent type")

```

### Grocery stores

Close proximity to a full service grocery store provides families with a greater ability to purchase fresh meat and produce on a regular basis. When access is limited, many families have depend on more convenient options like corner stores and gas stations, where foods are often cheaper but lower quality. This impacts individual health and leads to greater prevalence of preventable diseases such as obesity, heart disease, and type 2 diabetes.

Properties along the corridor are much more likely to be located within close proximity to a convenience store than a full-service grocery. Of all 23 properties, only one is located within a half mile distance of grocery store --- the Food Lion located at the Chippenham Parkway interchange.

The average distance between an apartment and a full-service grocery is 1.39 miles, while the average distance to a convenience store or small market is 0.40 miles. For those without a personal vehicle, the choice in traveling to get food is often an easy one to make when convenience stores like Dollar General are much more accessible.

On average, both affordable and market-rate apartments are a little less than half a mile from a convenience store. However, residents in market-rate properties are more likely to be significantly closer (1.2 miles away) to a SNAP retailer, such as a major grocery store, versus those in rent-restricted properties (1.8 miles).

```{r r1-grocery-setup, eval=FALSE}

# Grocery stores:
# We'll use SNAP retailers from the USDA as a proxy here
# This is not perfect so some filtering may be necessary
# as it picks up on convenience stores as well

snap <- read_csv("https://opendata.arcgis.com/datasets/e9cc76a48ccb45628181ece7b2deb56d_0.csv") %>%
  filter(State == "VA") %>%
  st_as_sf(coords = c("X", "Y"), crs = 4326) %>%
  st_transform(va_crs)

snap_fullservice <- snap |> 
  filter(str_detect(Store_Name, regex("food lion|publix|Costco|Kroger|aldi|lidl|whole foods|walmart|save-a-lot|sam's club|farm fresh", ignore_case = T)))

snap_convenience <- snap |> 
  filter(!str_detect(Store_Name, regex("food lion|publix|Costco|Kroger|aldi|lidl|whole foods|walmart|save-a-lot|sam's club|farm fresh", ignore_case = T)))
  
# Full service grocery filter

nearest_snap <- st_nn(r1_prj, snap_fullservice, k = 20)

r1_snap <- imap(nearest_snap, ~{

  property <- r1_prj[.y,]

  nearby_snap <- snap_fullservice[.x, ]

  mb_matrix(origins = property,
            destinations = nearby_snap,
            profile = "walking",
            output = "distance")
}) %>%
  reduce(rbind) %>%
  apply(1, min) %>%
  magrittr::divide_by(1609.34)

r1_snap_map <- costar_r1_map |>
  mutate(
    miles_to_snap = r1_snap,
    snap_nearby = ifelse(miles_to_snap <= 0.5, 1, 0))

# Convenience store filter

nearest_snapconvenience <- st_nn(r1_prj, snap_convenience, k = 20)

r1_convenience <- imap(nearest_snapconvenience, ~{

  property <- r1_prj[.y,]

  nearby_snapconvenience <- snap_convenience[.x, ]

  mb_matrix(origins = property,
            destinations = nearby_snapconvenience,
            profile = "walking",
            output = "distance")
}) %>%
  reduce(rbind) %>%
  apply(1, min) %>%
  magrittr::divide_by(1609.34)

r1_grocery_map <- r1_snap_map |>
  mutate(
    miles_to_convenience = r1_convenience,
    convenience_nearby = ifelse(miles_to_convenience <= 0.5, 1, 0))

write_rds(r1_grocery_map, "data/r1_grocery_map.rds")

# mean(r1_grocery_map$miles_to_snap)
# 1.352853

# mean(r1_convenience_map$miles_to_convenience)
# 0.3977947

```

```{r r1-grocery-chart, fig.cap="Mean distance from apartments in Route 1 corridor to food stores by type"}

r1_grocery_map <- read_rds("data/r1_grocery_map.rds")

r1_grocery_sum <- r1_grocery_map |> 
  st_drop_geometry() |> 
  drop_na(rent_type) |> 
  group_by(rent_type) |> 
  summarise(mean_snap = mean(miles_to_snap),
            mean_convenience = mean(miles_to_convenience)) |> 
  pivot_longer(2:3,
               names_to = 'store_type',
               values_to = 'miles') |> 
  mutate(store_type = case_when(
    store_type == "mean_snap" ~ "SNAP retailer",
    store_type == "mean_convenience" ~ "Convenience store"
  ))

gg_bar_col_facet(r1_grocery_sum,
                 x_var = store_type,
                 y_var = miles,
                 col_var = store_type,
                 facet_var = rent_type,
                 x_title = "",
                 y_title = "Miles",
                 x_labels = element_blank(),
                 col_labels = function(x) x,
                 title = "Mean distance from apartments in Route 1 corridor to food stores by type"
                 )

```

### Healthcare

Healthcare access is an important factor in improving not only individual health, but community health. Acute care general hospitals are open 24 hours a day, 365 days a year and provide patients with wellness services as well as emergency medical episodes that require intensive care. Urgent care facilities provide walk-in clinic services for minor illnesses and injuries outside a hospital setting. Access to both of these levels of care provide communities with a spectrum of care.

Along the corridor, the closest acute care hospital is Hunter Holmes McGuire Veterans Hospital, while the Concentra Urgent Care located in the Bellwood area is the closest urgent care facility. The average drive-time for a resident in a multifamily property along the corridor to an acute care hospital is 13.5 minutes, while their average drive-time to an urgent care is 7.5 minutes.

Nationally, the average travel time for residents in a suburban setting to a hospital is 12 minutes, slightly below that of the multifamily residents along the corridor.^[https://www.pewresearch.org/fact-tank/2018/12/12/how-far-americans-live-from-the-closest-hospital-differs-by-community-type/] 

There are no significant differences in the average driving time to both hospitals and urgent care facilities between affordable and market-rate properties in the corridor.

```{r r1-medical-setup, eval=FALSE}

# Hospital / urgent care
# I'm not filtering by type but you might consider doing so
# There are some other datasets in HIFLD on care centers that may 
# be relevant as well.

hospitals <- st_read("https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Hospitals_1/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson") %>%
  filter(STATE == "VA") %>%
  st_transform(va_crs) |> 
  filter(STATUS == "OPEN") |> 
  filter(TYPE == "GENERAL ACUTE CARE")

urgentcare <- st_read("https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Urgent_Care_Facilities/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson") %>%
  filter(STATE == "VA") %>%
  st_transform(va_crs)

nearest_hospitals <- st_nn(r1_prj, hospitals, k = 20)

costar_hospital_driving <- imap(nearest_hospitals, ~{
  # Get the specific property (the list index)
  property <- r1_prj[.y,]
  # Get the nearby hospitals (the indices in the list element)
  nearby_hospitals <- hospitals[.x, ]
  # Calculate the matrix (drive-times here instead)
  # Minutes are returned by default
  mb_matrix(origins = property,
            destinations = nearby_hospitals,
            profile = "driving",
            output = "duration")
}) %>%
  reduce(rbind) %>%
  apply(1, min)

r1_hospital_map <- costar_r1_map |>
  mutate(
    minutes_to_hospital = costar_hospital_driving,
    hospital_nearby = ifelse(minutes_to_hospital <= 15, 1, 0))

nearest_urgent <- st_nn(r1_prj, urgentcare, k = 20)

costar_urgent_driving <- imap(nearest_urgent, ~{
  # Get the specific property (the list index)
  property <- r1_prj[.y,]
  # Get the nearby hospitals (the indices in the list element)
  nearby_urgent <- urgentcare[.x, ]
  # Calculate the matrix (drive-times here instead)
  # Minutes are returned by default
  mb_matrix(origins = property,
            destinations = nearby_urgent,
            profile = "driving",
            output = "duration")
}) %>%
  reduce(rbind) %>%
  apply(1, min)

r1_health_map <- r1_hospital_map |>
  mutate(
    minutes_to_urgent = costar_urgent_driving,
    urgent_nearby = ifelse(minutes_to_urgent <= 15, 1, 0))

write_rds(r1_health_map, "data/r1_health_map.rds")

# mean(r1_health_map$minutes_to_hospital)
# 13.5442

# mean(r1_health_map$minutes_to_urgent)
# 7.530435

```

```{r r1-health-chart, fig.cap="Mean driving time from apartments in Route 1 corridor to healthcare facility by type"}

r1_health_map <- read_rds("data/r1_health_map.rds")

r1_health_sum <- r1_health_map |> 
  st_drop_geometry() |> 
  drop_na(rent_type) |> 
  group_by(rent_type) |> 
  summarise(mean_hospital = mean(minutes_to_hospital),
            mean_urgent = mean(minutes_to_urgent)) |> 
  pivot_longer(2:3,
               names_to = 'health_type',
               values_to = 'minutes') |> 
  mutate(health_type = case_when(
    health_type == "mean_hospital" ~ "Hospital",
    health_type == "mean_urgent" ~ "Urgent care"
  ))

gg_bar_col_facet(r1_health_sum,
                 x_var = health_type,
                 y_var = minutes,
                 col_var = health_type,
                 facet_var = rent_type,
                 x_title = "",
                 y_title = "Minutes",
                 col_title = "Facility",
                 x_labels = element_blank(),
                 col_labels = function(x) x,
                 title = "Mean driving time from apartments in Route 1 corridor to healthcare facility by type"
                 )



```

### Job centers

Living close to well-paying jobs can increase economic opportunities for low- and moderate-income households. When those opportunities are a further distance from where someone lives, that can often mean more money spent on commuting and less money for essentials like healthcare and housing. 

Multifamily properties regardless of type or location along the corridor are generally well-located in relation to jobs. However, the northern section of the corridor sees greater proximity to more jobs --- largely because of the City of Richmond.

Furthermore, properties closer to the city-county border are also in closer proximity to jobs paying greater than \$3,333 a month, or $39,996 annually. This is the highest wage category available in the data. On average, 54 percent of the jobs located within a 15 minute drive of properties pay more than \$3,333 per month. Workers in both market-rate and rent-restricted apartments have nearly the same access to jobs of different wages.

Fewer high-paying job opportunities exist towards the southern end of the corridor, despite higher end developments like The Jane and Colony Village. This most likely means that many residents are commuting longer distances away from the corridor for work. 

```{r r1-jobs, eval=FALSE}

va_wac <- grab_lodes(
  state = "va",
  year = 2019,
  lodes_type = "wac",
  use_cache = TRUE
)

# Jobs with earnings more than $3333/month.

va_jobs <- va_wac %>%
  select(w_geocode, total_jobs = C000, hi_paying_jobs = CE03, mid_paying_jobs = CE02, lo_paying_jobs = CE01, hs_jobs = CD02, ba_jobs = CD04)

options(tigris_use_cache = TRUE)

va_blocks <- blocks("VA", year = 2019)

va_jobs_sf <- va_blocks %>%
  select(w_geocode = GEOID10) %>%
  inner_join(va_jobs, by = "w_geocode")

# Removed time because depart at not allowed anymore?

costar_isos <- mb_isochrone(
  location = costar_r1_map,
  profile = "driving",
  time = 15,
  id_column = "property_id"
)

reachable_jobs <- st_join(
  st_transform(costar_isos, 6594),
  st_centroid(st_transform(va_jobs_sf, 6594)),
  left = FALSE
) %>%
  st_drop_geometry() %>%
  group_by(id) %>%
  summarize(hi_jobs = sum(hi_paying_jobs, na.rm = TRUE),
            mid_jobs = sum(mid_paying_jobs, na.rm = TRUE),
            lo_jobs = sum(lo_paying_jobs, na.rm = TRUE),
            total_jobs = sum(total_jobs, na.rm = TRUE),
            hs_jobs = sum(hs_jobs, na.rm = TRUE),
            ba_jobs = sum(ba_jobs, na.rm = TRUE))

r1_jobs <- costar_r1_map |> 
  mutate(id = property_id)|> 
  left_join(reachable_jobs, by = "id") |> 
  select(property_name, property_address, rent_type,
         total_jobs, hi_jobs, mid_jobs, lo_jobs, ba_jobs, hs_jobs) |> 
  transform(hi_percent = hi_jobs/total_jobs) |> 
  transform(lo_percent = lo_jobs/total_jobs) |> 
  drop_na(rent_type)

write_rds(r1_jobs, "data/r1_jobs.rds")

# mean(r1_jobs_list$hi_percent)
# 0.5403631

```

```{r r1-jobs-chart, fig.cap="Percent of jobs by wage within 15 minute drive by rent type in the Route 1 corridor"}

r1_jobs <- read_rds("data/r1_jobs.rds")

r1_jobs_sum <- r1_jobs |>
  st_drop_geometry() |> 
  group_by(rent_type) |> 
  summarise(lo_jobs = sum(lo_jobs)/sum(total_jobs),
            mid_jobs = sum(mid_jobs)/sum(total_jobs),
            hi_jobs = sum(hi_jobs)/sum(total_jobs)) |> 
  pivot_longer(2:4,
               names_to = "wage",
               values_to = "pct") |> 
  mutate(wage = case_when(
    wage == "lo_jobs" ~ "$15,000 or less",
    wage == "mid_jobs" ~ "$15,000 to $39,996",
    wage == "hi_jobs" ~ "More than $39,996"
  ))

gg_bar_col_facet(r1_jobs_sum,
                 x_var = wage,
                 y_var = pct,
                 col_var = wage,
                 facet_var = rent_type,
                 x_title = "",
                 y_title = "Percent",
                 col_title = "Annualized wage",
                 x_labels = element_blank(),
                 y_labels = label_percent(),
                 col_labels = function(x) x,
                 title = "Percent of jobs by wage within 15 minute drive of apartments by rent type in the Route 1 corridor"
                 )

```

## Public and private investments

Chesterfield County has largely focused revitalization efforts on the northern section on the Route 1 corridor. The Northern Jefferson Davis Special Area Plan was adopted in 2018 and reflects the County's ongoing commitment to improve quality of life for residents of the corridor. Recent public projects include:

-   **Bensley Park** field renovations and paving.
-   **Shared-Use Path** planned for Route 1 from Marina Drive to Elliham Avenue.
-   **Falling Creek Ironworks Park** improvements in planning.

Additionally, the Board of Supervisors approved the Route 1 Residential Overlay ordinance in 2019, which allows for high density multifamily development by-right in C3 and C5 zoned parcels with some restrictions. This ordinance also [reduced parking requirements for apartments located within a quarter-mile of bus stops](https://www.chesterfieldobserver.com/articles/county-offers-parking-credits-to-developers-on-route-1/) and encourages less auto-centric development, which has historically stifled revitalization of the corridor.

The Board of Supervisors also extended the [Route 1 tax abatement policy](https://www.chesterfield.gov/CivicAlerts.aspx?AID=2448&ARC=3953). The policy provides the developer of a qualifying project with a grant equal to 80 percent of their increasing real estate taxes for the first seven years after completion of the project. Over the final three years, the grant reduces to 60, 40, and 20 percent, respectively. Better Housing Coalition's Winchester Forest development, which will result in 160 rental homes by early 2024, is the first development to utilize this incentive.

With these incentives, as well as the Route 1 GRTC pilot, the County has continued to invest in the corridor to spur much-needed development. With dwindling supply of market affordable housing and at-risk manufactured home communities, many low- and moderate-income families will have few to no options for safe and stable housing.

Private development interest is also coming to the corridor with Thalhimer Realty Partners proposing a mixed-use project at the Bellwood Flea Market site at the southeast corner Route 1 and Willis Road. This redevelopment project would see 690 new residential units and commercial space across 40 acres --- bringing additional homeownership and rental opportunities to the corridor. Projects like this help bring new economic activity to the corridor and additional rooftops to justify additional commercial development along the corridor.

Nonprofit development interest has continued from Better Housing Coalition further down the corridor at the historic Colbrook Motel site south of Route 10. At this site, they plan to develop 156 rental homes in an apartment and townhome setting. Meanwhile, Maggie Walker Community Land Trust is in the early planning stages for an agricultural neighborhood development off of Swineford Road. MWCLT will offer homeownership opportunities under their community land trust model --- often serving first-time home buyers of color.

### Case study

```
Bermuda Estates or The Jane at Moore's Lake

-   Add a photo
-   Describe development and market it serves
-   Rent/sale prices
```

