# Household cost burden {#part-1b-3}

This section provides an analysis of cost burden within Chesterfield County disaggregated by tenure, age, and race/ethnicity.

## Background

[reserved]

```{r global, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, 
                      message=FALSE, 
                      warning=FALSE, 
                      include=FALSE)

```

## Tenure

```{r tenure}
library(glue)
library(httr)
library(jsonlite)
library(tidyverse)
library(usethis)

hud <- "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImI5NjcyMzM3MjBkMGNlZWUxMGE5NjU0MWMzNmUyZWMzNzc4NWExOWFlMjMwMzM5YjFlZDg2NmQ3M2JkOTNkNjk5YmYzZGFmZTQyMWU3YjBlIn0.eyJhdWQiOiI2IiwianRpIjoiYjk2NzIzMzcyMGQwY2VlZTEwYTk2NTQxYzM2ZTJlYzM3Nzg1YTE5YWUyMzAzMzliMWVkODY2ZDczYmQ5M2Q2OTliZjNkYWZlNDIxZTdiMGUiLCJpYXQiOjE2NDcyODg0NjEsIm5iZiI6MTY0NzI4ODQ2MSwiZXhwIjoxOTYyOTA3NjYxLCJzdWIiOiIzMTEzOSIsInNjb3BlcyI6W119.fi0sEW9r_1i4_0pDI69ejp8rOhmc8xBL-yzhTpRvIQ5lX3kqEavFJ-GDg3FKVP_6Q9hdyhrRefVe6jH-SkAm6g"



get_hud_chas <- function(
  type, 
  year = "2013-2017", 
  state_id = NULL, 
  entity_id = NULL, 
  token = NULL
) {
  
  # Check to see if a token exists
  if (is.null(hud)) {
    if (Sys.getenv(hud) != "") {
      token <- Sys.getenv(hud)
    }
  }
  
  # Specify the base URL
  base_url <- "https://www.huduser.gov/hudapi/public/chas"
  
  # Make the query
  hud_query <- httr::GET(
    base_url,
    httr::add_headers(Authorization = glue::glue("Bearer {token}")),
    query = list(
      type = type,
      year = year,
      stateId = state_id,
      entityId = entity_id)
  )
  
  # Return the HTTP error message if query failed
  if (hud_query$status_code != "200") {
    msg <- httr::content(hud_query, as = "text")
    return(msg)
  }
  
  # Return the content as text
  hud_content <- httr::content(hud_query, as = "text")
  
  # Convert the data to a long-form tibble
  hud_tibble <- hud_content |>
    jsonlite::fromJSON() |>
    dplyr::as_tibble() |>
    tidyr::pivot_longer(cols = !dplyr::all_of(c("geoname", "sumlevel", "year")),
                        names_to = "indicator",
                        values_to = "value")
  
  return(hud_tibble)
}

get_hud_chas(type = 3, state_id = 51, entity_id = 510)
```

## Age

[reserved]

## Race/ethnicity

[reserved]

## Takeaways

[reserved]