# Household cost burden {#part-1b-3}

This section provides an analysis of cost burden within Chesterfield County disaggregated by tenure, age, and race/ethnicity.

## Background

[reserved]

```{r global, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, 
                      message=FALSE, 
                      warning=FALSE, 
                      include=FALSE)

```

## Tenure

```{r tenure}
library(glue)
library(httr)
library(jsonlite)
library(tidyverse)
library(readxl)

my_token <- Sys.getenv("HUD_KEY")

hud_chas_request <- GET("https://www.huduser.gov/hudapi/public/chas?type=3&year=2012-2016&stateId=51&entityId=59",
                        add_headers(Authorization = glue("Bearer {my_token}")))

hud_chas_request$status_code

get_hud_chas <- function(
  type, 
  year = NULL, 
  state_id = NULL, 
  entity_id = NULL, 
  token = NULL
) {
  
  # Check to see if a token exists
  if (is.null(token)) {
    if (Sys.getenv("HUD_KEY") != "") {
      token <- Sys.getenv("HUD_KEY")
    }
  }
  
  # Specify the base URL
  base_url <- "https://www.huduser.gov/hudapi/public/chas"
  
  # Make the query
  hud_query <- httr::GET(
    base_url,
    httr::add_headers(Authorization = glue::glue("Bearer {token}")),
    query = list(
      type = type,
      year = year,
      stateId = state_id,
      entityId = entity_id)
  )
  
  # Return the HTTP error message if query failed
  if (hud_query$status_code != "200") {
    msg <- httr::content(hud_query, as = "text")
    return(msg)
  }
  
  # Return the content as text
  hud_content <- httr::content(hud_query, as = "text")
  
  # Convert the data to a long-form tibble
  hud_tibble <- hud_content |>
    jsonlite::fromJSON() |>
    dplyr::as_tibble() |>
    tidyr::pivot_longer(cols = !dplyr::all_of(c("geoname", "sumlevel", "year")),
                        names_to = "indicator",
                        values_to = "value")
  
  return(hud_tibble)
  
}

years <- c("2014-2018", "2013-2017","2012-2016","2011-2015", "2010-2014", 
           "2009-2013", "2008-2012","2007-2011", "2006-2010")

chesterfield <- map_dfr(years, function(yr){
  chesterfield_chas <- get_hud_chas(
    type = 3, 
    year = yr, 
    state_id = 51, 
    entity_id = 041
    )
})

labels <- read_excel("data/CHAS_HUD_Dictionary.xlsx")

chesterfield_chas <- chesterfield %>%
  right_join(labels, by = 'indicator')

```

## Age

[reserved]

## Race/ethnicity

[reserved]

## Takeaways

[reserved]